<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom</title>
    <link rel="icon" href="https://ssl.gstatic.com/classroom/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:100,300,400,500,700,900,100i,300i,400i,500i,700i,900i">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Google Sans', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark {
            background-color: #121212;
            color: #e0e0e0;
        }
        .dark .bg-white {
            background-color: #1e1e1e;
        }
        .dark .text-gray-800 {
            color: #f0f0f0;
        }
        .dark .text-gray-600 {
            color: #b0b0b0;
        }
        .dark .border-gray-300 {
            border-color: #444;
        }
        .dark .bg-gray-200 {
            background-color: #333;
        }
        .dark .border-gray-300 {
            border-color: #555;
        }
        .dark .text-gray-500 {
            color: #888;
        }
        .page-transition {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(16px);
            opacity: 0;
        }
        .page-transition.active {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-gray-100 dark:bg-gray-900 transition-colors">
    <div id="main-container" class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-2xl text-center transition-colors">
        
        <div id="mainPage" class="page-transition">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Lunar Launcher V2.2</h1>
                <div class="flex space-x-2">
                    <button id="helpButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">Help</button>
                    <button id="settingsButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">Settings</button>
                    <button id="updateLogButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">Update Log</button>
                    <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        <svg id="moonIcon" class="h-6 w-6 text-gray-800 dark:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                        <svg id="sunIcon" class="h-6 w-6 text-gray-800 dark:text-gray-200 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Enter a YouTube video or playlist URL or ID to launch it in a new tab.</p>
            
            <div class="mb-4">
                <input type="text" id="videoInput" placeholder="Paste YouTube URL or ID here" value="https://www.youtube.com/watch?v=LfHm50UJW6U" class="flex-grow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-gray-200 transition duration-200">
            </div>

            <div class="flex items-center justify-center mb-6">
                <input type="checkbox" id="loopCheckbox" class="h-5 w-5 rounded text-blue-600 focus:ring-2 focus:ring-blue-500">
                <label for="loopCheckbox" class="ml-2 text-gray-700 dark:text-gray-300 select-none">Loop video (only works for single videos)</label>
            </div>

            <button id="goButton" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 w-full">Launch</button>
        </div>

        <div id="settingsPage" class="page-transition hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="backFromSettingsButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">Back</button>
                <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">Settings</h2>
            </div>
            
            <div class="text-left">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Cloak Settings</h3>
                <div class="space-y-4">
                    <div>
                        <label for="cloakTitleInput" class="block text-gray-700 dark:text-gray-300 mb-2">Website Title:</label>
                        <input type="text" id="cloakTitleInput" placeholder="Enter new title" value ="Classroom" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-gray-200">
                    </div>
                    <div>
                        <label for="cloakFaviconInput" class="block text-gray-700 dark:text-gray-300 mb-2">Favicon URL:</label>
                        <input type="text" id="cloakFaviconInput" placeholder="Enter new favicon URL" value="https://ssl.gstatic.com/classroom/favicon.png" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-gray-200">
                    </div>
                    <div>
                        <label for="videoTabTitleInput" class="block text-gray-700 dark:text-gray-300 mb-2">Video Tab Title:</label>
                        <input type="text" id="videoTabTitleInput" placeholder="Enter new title for video tab" value="Classroom" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-gray-200">
                    </div>
                    <button id="saveCloakButton" class="w-full px-4 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors">
                        Save Cloak Settings
                    </button>
                </div>
            </div>
        </div>

        <div id="helpPage" class="page-transition hidden">
            <div class="flex items-center mb-6">
                <button id="backFromHelpButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 ml-4">Help</h1>
            </div>
            <p class="text-gray-600 dark:text-gray-400 text-left mb-4">
                Welcome to Lunar Launcher! This tool allows you to easily open YouTube videos and playlists in a new tab. This can be useful for focusing on the video content without distractions.
            </p>
            <p class="text-gray-600 dark:text-gray-400 text-left mb-4">
                Simply paste a YouTube video URL, video ID, or playlist URL into the text box on the main page. The launcher will automatically detect the video and playlist IDs from the link.
            </p>
            <p class="text-gray-600 dark:text-gray-400 text-left">
                You can also customize the appearance of the launcher and the video tabs in the Settings menu. This includes changing the title and favicon to make it look like a different website.
            </p>
        </div>

        <!--update log pg-->
        
        <div id="updateLogMainPage" class="page-transition hidden">
            <div class="flex items-center mb-6">
                <button id="backFromUpdateLogMainButton" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 ml-4">Update Log</h1>
            </div>
            <div class="text-left space-y-4">
                <button class="update-log-version-button w-full text-left p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-target="v21Page">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">V2.1 - September 13, 2025</h3>
                </button>
                <button class="update-log-version-button w-full text-left p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-target="v20Page">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">V2.0 - September 10, 2025</h3>
                </button>
            </div>
        </div>

        <div id="v21Page" class="page-transition hidden">
            <div class="flex items-center mb-6">
                <button id="backFromV21Button" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 ml-4">Update V2.1</h1>
            </div>
            <div class="text-left p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">V2.1 - September 13, 2025</h3>
                <ul class="list-disc list-inside mt-2 text-gray-600 dark:text-gray-400">
                    <li><strong>Help Page</strong> Added the help page.</li>
                    <li><strong>Fixed Bold Text</strong> Lunar Team officialy fixed Bold Text.</li>
                    <li><strong>Transitions</strong> Added Smooth keyframe transitions.</li>
                    <li>Minor bug fixes and performance improvements.</li>
                </ul>
            </div>
        </div>

        <div id="v20Page" class="page-transition hidden">
            <div class="flex items-center mb-6">
                <button id="backFromV20Button" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 ml-4">Update V2.0</h1>
            </div>
            <div class="text-left p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">V2.0 - September 12, 2025</h3>
                <ul class="list-disc list-inside mt-2 text-gray-600 dark:text-gray-400">
                    <li><strong>Playlist Looping:</strong> Lunar has officialy added Playlist looping.</li>
                    <li><strong>Video Looping:</strong> Lunar has officialy added Video Looping allowing users to loop videos.</li>
            </div>
        </div>

        <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm mx-4">
                <p id="messageText" class="text-gray-800 mb-4"></p>
                <button id="closeMessage" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-200">Close</button>
            </div>
        </div>
    </div>

    <script>
        const videoInput = document.getElementById('videoInput');
        const goButton = document.getElementById('goButton');
        const loopCheckbox = document.getElementById('loopCheckbox');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessage = document.getElementById('closeMessage');
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        const helpButton = document.getElementById('helpButton');
        const settingsButton = document.getElementById('settingsButton');
        const updateLogButton = document.getElementById('updateLogButton');
        
        const mainPage = document.getElementById('mainPage');
        const settingsPage = document.getElementById('settingsPage');
        const helpPage = document.getElementById('helpPage');
        const updateLogMainPage = document.getElementById('updateLogMainPage');
        const v21Page = document.getElementById('v21Page');
        const v20Page = document.getElementById('v20Page');

        const backFromSettingsButton = document.getElementById('backFromSettingsButton');
        const backFromHelpButton = document.getElementById('backFromHelpButton');
        const backFromUpdateLogMainButton = document.getElementById('backFromUpdateLogMainButton');
        const backFromV21Button = document.getElementById('backFromV21Button');
        const backFromV20Button = document.getElementById('backFromV20Button');

        const cloakTitleInput = document.getElementById('cloakTitleInput');
        const cloakFaviconInput = document.getElementById('cloakFaviconInput');
        const videoTabTitleInput = document.getElementById('videoTabTitleInput');
        const saveCloakButton = document.getElementById('saveCloakButton');

        function showPage(page) {
            const pages = [mainPage, settingsPage, helpPage, updateLogMainPage, v21Page, v20Page];
            pages.forEach(p => {
                p.classList.add('hidden');
                p.classList.remove('active');
            });
            page.classList.remove('hidden');
            void page.offsetWidth;  
            page.classList.add('active');
        }

        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        closeMessage.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
            if (document.body.classList.contains('dark')) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        });

        helpButton.addEventListener('click', () => {
            showPage(helpPage);
        });

        settingsButton.addEventListener('click', () => {
            showPage(settingsPage);
        });
        
        updateLogButton.addEventListener('click', () => {
            showPage(updateLogMainPage);
        });

        backFromSettingsButton.addEventListener('click', () => {
            showPage(mainPage);
        });

        backFromHelpButton.addEventListener('click', () => {
            showPage(mainPage);
        });
        
        backFromUpdateLogMainButton.addEventListener('click', () => {
            showPage(mainPage);
        });

        backFromV21Button.addEventListener('click', () => {
            showPage(updateLogMainPage);
        });

        backFromV20Button.addEventListener('click', () => {
            showPage(updateLogMainPage);
        });

        document.querySelectorAll('.update-log-version-button').forEach(button => {
            button.addEventListener('click', (e) => {
                const targetId = e.currentTarget.dataset.target;
                const targetPage = document.getElementById(targetId);
                if (targetPage) {
                    showPage(targetPage);
                }
            });
        });

        goButton.addEventListener('click', () => {
            let inputValue = videoInput.value.trim();

            if (inputValue === "") {
                showMessage("Please enter a YouTube URL or video ID.");
                return;
            }

            let videoId = null;
            let playlistId = null;
            
            const getIDs = (url) => {
                try {
                    const parsedUrl = new URL(url);
                    const params = new URLSearchParams(parsedUrl.search);
                    return {
                        videoId: params.get('v'),
                        playlistId: params.get('list')
                    };
                } catch (e) {
                    const videoIdRegex = /^[a-zA-Z0-9_-]{11}$/;
                    if (videoIdRegex.test(url)) {
                        return { videoId: url, playlistId: null };
                    }
                    const playlistIdRegex = /^(PL|LL|RD|EC|UU|FL|LP)[a-zA-Z0-9_-]+$/;
                    if (playlistIdRegex.test(url)) {
                        return { videoId: null, playlistId: url };
                    }
                    return { videoId: null, playlistId: null };
                }
            };
            
            const ids = getIDs(inputValue);
            videoId = ids.videoId;
            playlistId = ids.playlistId;

            if (playlistId && !videoId) {
                let embedUrl = `https://www.youtube.com/embed/videoseries?list=${playlistId}`;
                openAndRedirect(embedUrl);
                return;
            }

            if (!videoId) {
                showMessage("The input does not appear to be a valid YouTube URL or ID.");
                return;
            }

            let embedUrl;
            if (playlistId) {
                embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}?list=${playlistId}`;
            } else {
                embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}`;
                if (loopCheckbox.checked) {
                    embedUrl += `?loop=1`;
                }
            }
            
            openAndRedirect(embedUrl);
        });

        function openAndRedirect(embedUrl) {
            const videoTabTitle = localStorage.getItem('videoTabTitle') || 'YouTube Video';
            const faviconUrl = localStorage.getItem('cloakFavicon');

            try {
                const newWindow = window.open('about:blank', '_blank');
                if (newWindow) {
                    newWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>${videoTabTitle}</title>
                            ${faviconUrl ? `<link rel="icon" href="${faviconUrl}" type="image/x-icon">` : ''}
                            <style>
                                body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
                                iframe { width: 100%; height: 100%; border: none; }
                            </style>
                        </head>
                        <body>
                            <iframe src="${embedUrl}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                        </body>
                        </html>
                    `);
                    newWindow.document.close();

                    window.location.href = 'https://www.google.com';
                } else {
                    showMessage("Pop-up blocked. Please allow pop-ups for this site to launch the video.");
                }
            } catch (e) {
                showMessage("A security error occurred. The video could not be launched this way.");
                console.error("Failed to write to new window:", e);
            }
        }

        saveCloakButton.addEventListener('click', () => {
            const newTitle = cloakTitleInput.value;
            const newFavicon = cloakFaviconInput.value;
            const newVideoTabTitle = videoTabTitleInput.value;

            localStorage.setItem('cloakTitle', newTitle);
            localStorage.setItem('cloakFavicon', newFavicon);
            localStorage.setItem('videoTabTitle', newVideoTabTitle);
            
            if (newTitle) {
                document.title = newTitle;
            }

            if (newFavicon) {
                let faviconLink = document.querySelector("link[rel~='icon']");
                if (!faviconLink) {
                    faviconLink = document.createElement('link');
                    faviconLink.rel = 'icon';
                    document.getElementsByTagName('head')[0].appendChild(faviconLink);
                }
                faviconLink.href = newFavicon;
            }
            
            showMessage("Cloak settings saved and applied!");
        });

        window.addEventListener('load', () => {
            const savedTitle = localStorage.getItem('cloakTitle');
            const savedFavicon = localStorage.getItem('cloakFavicon');
            const savedVideoTabTitle = localStorage.getItem('videoTabTitle');
            
            if (savedTitle) {
                document.title = savedTitle;
                cloakTitleInput.value = savedTitle;
            }

            if (savedFavicon) {
                let faviconLink = document.querySelector("link[rel~='icon']");
                if (!faviconLink) {
                    faviconLink = document.createElement('link');
                    faviconLink.rel = 'icon';
                    document.getElementsByTagName('head')[0].appendChild(faviconLink);
                }
                faviconLink.href = savedFavicon;
                cloakFaviconInput.value = savedFavicon;
            }
            
            if (savedVideoTabTitle) {
                videoTabTitleInput.value = savedVideoTabTitle;
            }

            showPage(mainPage);
        });
    </script>
</body>
</html>
